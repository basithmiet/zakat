<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zakat Calculator</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  /* Islamic-inspired palette */
  --bg:#071e16; /* deep emerald */
  --card:#0f2b22; /* dark card */
  --accent:#d4af37; /* gold */
  --muted:#f6eddc; /* parchment */
  --text:#f8f4ea; /* warm ivory */
  --error:#ff6b6b;
}

/* Ensure consistent sizing to prevent inputs overflowing/overlapping */
*,*::before,*::after{box-sizing:border-box}

body.light{
  --bg:#f4f6f9;
  --card:#ffffff;
  --text:#000000;
}

body{
  margin:0;
  font-family: 'Cairo', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
  background:var(--bg);
  color:var(--text);
  transition:.3s;
}

.container{
  padding:20px;
  display:flex;
  justify-content:center;
}

.card{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03)), var(--card);
  max-width:1000px;
  width:100%;
  padding:25px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(2,6,3,.6), 0 0 30px rgba(212,175,55,0.04) inset;
  border:1px solid rgba(212,175,55,0.08);
}

h2{
  text-align:center;
  margin-bottom:5px;
  letter-spacing:0.6px;
  position:relative;
  font-weight:600;
}

/* decorative crescent removed */

.date{
  text-align:center;
  font-size:14px;
  opacity:.8;
  margin-bottom:20px;
}

.grid{
  display:grid;
  grid-template-columns:1fr;
  gap:15px;
}

.grid > div{min-width:0;display:flex;flex-direction:column}

@media(min-width:768px){
  .grid{
    grid-template-columns:1fr 1fr;
  }
}

label{
  font-size:14px;
}

input{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.06);
  margin-top:5px;
  background:rgba(255,255,255,0.02);
  color:var(--text);
}

.checkbox-group{
  margin-top:15px;
  display:flex;
  gap:20px;
}

button{
  padding:14px;
  border:none;
  border-radius:8px;
  background:var(--accent);
  color:#1b1b1b;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 6px 18px rgba(212,175,55,0.12);
  transition:transform .14s ease, box-shadow .14s ease;
}

button:hover{transform:translateY(-2px);box-shadow:0 10px 22px rgba(212,175,55,0.16)}

.full-width{
  width:100%;
  margin-top:20px;
}

.button-row{
  display:grid;
  grid-template-columns:1fr;
  gap:10px;
  margin-top:15px;
}

@media(min-width:600px){
  .button-row{
    grid-template-columns:1fr 1fr 1fr;
  }
}

.result{
  margin-top:20px;
  font-size:18px;
  text-align:center;
  font-weight:bold;
}

canvas{
  margin-top:20px;
}

/* Responsive layout tweaks */
@media (max-width:599px){
  .card{padding:16px;border-radius:12px}
  h2{font-size:20px}
  .date{font-size:13px}
  input{font-size:16px;padding:12px}
  .checkbox-group{flex-direction:column;gap:8px}
  .button-row{display:flex;flex-direction:column;gap:10px}
  .button-row button{width:100%}
  canvas{max-height:300px}
}

@media (min-width:600px) and (max-width:899px){
  .grid{grid-template-columns:1fr 1fr}
  .button-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  canvas{max-height:350px}
}

@media (min-width:900px){
  .grid{grid-template-columns:1fr 1fr}
  .card{padding:28px}
  canvas{max-height:420px}
}

.footer{
  text-align:center;
  margin-top:30px;
  font-size:14px;
  opacity:.8;
}

/* decorative page background: subtle geometric motif */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background-image: radial-gradient(rgba(212,175,55,0.02) 1px, transparent 1px);
  background-size:24px 24px;
  pointer-events:none;
  opacity:0.45;
}
</style>
</head>

<body>

<div class="container">
<div class="card">

<h2>Zakat Calculator</h2>
<div class="date" id="todayDate"></div>

<div class="grid">

<div>
<label>Cash (‚Çπ)</label>
<input type="text" id="cash">
</div>

<div>
<label>Bank (‚Çπ)</label>
<input type="text" id="bank">
</div>

<div>
<label>Gold (grams)</label>
<input type="text" id="goldGrams">
</div>

<div>
<label>Silver (grams)</label>
<input type="text" id="silverGrams">
</div>

<div>
<label>Gold Price per gram (‚Çπ)</label>
<input type="text" id="goldPrice">
</div>

<div>
<label>Silver Price per gram (‚Çπ)</label>
<input type="text" id="silverPrice">
</div>

<div>
<label>Investments (‚Çπ)</label>
<input type="text" id="investments">
</div>

<div>
<label>Business Stock (‚Çπ)</label>
<input type="text" id="business">
</div>

<div>
<label>Debts (‚Çπ)</label>
<input type="text" id="debts">
</div>

</div>

<div class="checkbox-group">
<label><input type="checkbox" id="useGold" checked> Use Gold Nisab</label>
<label><input type="checkbox" id="useSilver"> Use Silver Nisab</label>
</div>

<button class="full-width" onclick="calculate()">Calculate Zakat</button>

<!--
<div class="button-row">
  <button onclick="exportPDF()">Export PDF</button>
  <button onclick="toggleTheme()">Theme</button>
  <button onclick="alert('Language feature coming soon üôÇ')">Language</button>
</div>
-->

<div class="result" id="result"></div>
<canvas id="chart"></canvas>

<div class="footer">
Developed by Basith ‚ù§Ô∏è Roshni
</div>

</div>
</div>

<script>
document.getElementById("todayDate").innerText =
new Date().toLocaleDateString();

let chart;

function getValidNumber(id){
let value=document.getElementById(id).value.trim();
let number=parseFloat(value);
if(isNaN(number) || number<0){
return 0;
}
return number;
}

function calculate(){
  let cash=getValidNumber("cash");
  let bank=getValidNumber("bank");
  let gold=getValidNumber("goldGrams");
  let silver=getValidNumber("silverGrams");
  let gp=getValidNumber("goldPrice");
  let sp=getValidNumber("silverPrice");
  let invest=getValidNumber("investments");
  let business=getValidNumber("business");
  let debts=getValidNumber("debts");

  const goldValue=gold*gp;
  const silverValue=silver*sp;
  const total=cash+bank+goldValue+silverValue+invest+business;
  const net=total-debts;

  // read checkboxes explicitly (avoid relying on implicit global variables)
  const useGoldChecked = document.getElementById('useGold')?.checked === true;
  const useSilverChecked = document.getElementById('useSilver')?.checked === true;

  // only compute nisab values if corresponding prices are provided (>0)
  const goldNisab = gp > 0 ? 87.48 * gp : null;
  const silverNisab = sp > 0 ? 612.36 * sp : null;

  let nisab = null;
  if(useGoldChecked && useSilverChecked){
    const candidates = [];
    if(goldNisab !== null) candidates.push(goldNisab);
    if(silverNisab !== null) candidates.push(silverNisab);
    if(candidates.length) nisab = Math.min(...candidates);
  } else if(useGoldChecked){
    if(goldNisab !== null) nisab = goldNisab;
  } else if(useSilverChecked){
    if(silverNisab !== null) nisab = silverNisab;
  } else {
    // neither checked: prefer gold if available, otherwise silver
    if(goldNisab !== null) nisab = goldNisab;
    else if(silverNisab !== null) nisab = silverNisab;
  }

  const resultEl = document.getElementById('result');
  if(nisab === null){
    resultEl.innerHTML = "Enter gold/silver price to compute Nisab";
    renderChart(cash,bank,goldValue,silverValue,invest,business);
    return;
  }

  const zakat = net * 0.025;
  if(net >= nisab){
    resultEl.innerHTML = "Zakat Payable: ‚Çπ" + zakat.toFixed(2) + " (Nisab: ‚Çπ" + nisab.toFixed(2) + ")";
  } else {
    resultEl.innerHTML = "Below Nisab (Nisab: ‚Çπ" + nisab.toFixed(2) + ")";
  }

  renderChart(cash,bank,goldValue,silverValue,invest,business);
}

function renderChart(cash,bank,gold,silver,invest,business){
if(chart) chart.destroy();
chart=new Chart(document.getElementById("chart"),{
type:"pie",
data:{
labels:["Cash","Bank","Gold","Silver","Investments","Business"],
datasets:[{data:[cash,bank,gold,silver,invest,business]}]
}
});
}

function exportPDF(){
const { jsPDF } = window.jspdf;
let doc=new jsPDF();
doc.text("Zakat Calculation Summary",20,20);
doc.text(result.innerText,20,30);

let now=new Date();
let year=now.getFullYear();
let month=String(now.getMonth()+1).padStart(2,'0');
let day=String(now.getDate()).padStart(2,'0');
let hours=now.getHours();
let minutes=String(now.getMinutes()).padStart(2,'0');
let seconds=String(now.getSeconds()).padStart(2,'0');
let ampm=hours>=12?"PM":"AM";
hours=hours%12||12;
hours=String(hours).padStart(2,'0');

let formatted=`${year}-${month}-${day} ${hours}-${minutes}-${seconds} ${ampm}`;
doc.save(`zakat-report-${formatted}.pdf`);
}

function toggleTheme(){
document.body.classList.toggle("light");
}
</script>

</body>
</html>
